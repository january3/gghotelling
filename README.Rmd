---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  fig.align = "center",
  fig.width = 12,
  fig.height = 6,
  dpi = 96
)
```

# Hotelling's T² Ellipses and Outlier Detection for ggplot2 <img src="man/figures/logo.png" align="right" height="139" alt="" />
<!-- badges: start -->
[![R-CMD-check](https://github.com/january3/gghotelling/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/january3/gghotelling/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/january3/gghotelling/graph/badge.svg)](https://app.codecov.io/gh/january3/gghotelling)
<!-- badges: end -->

Here are a few examples of plots you can create with `gghotelling`:


```{r example-nocode,echo=FALSE}
library(ggplot2)
library(gghotelling)
library(cowplot)
library(ggrepel)

pca <- prcomp(iris[, 1:4], scale.=TRUE)
df <- cbind(iris, pca$x)

p1 <- ggplot(df, aes(PC1, PC2, color=Species)) +
  geom_hotelling(alpha=0.1, aes(fill = Species)) +
  ggtitle("Hotelling T² ellipses") +
  geom_point()

p2 <- ggplot(df, aes(PC1, PC2, group=Species, label=rownames(df))) +
  geom_hotelling(alpha=0.1, aes(fill = Species)) +
  geom_point(aes(color = Species)) +
  stat_outliers(geom="label_repel",
                        outlier_only = TRUE) +
  ggtitle("Detect outliers")

rings <- lapply(seq(.05, .95, length.out = 10), \(i) {
  geom_kde(aes(fill = Species), alpha =.05, coverage = i)
})

p3 <- ggplot(df, aes(x = PC1, y = PC2, color=Species)) +
  rings +
  geom_point() +
  ggtitle("Kernel density contours")

library(HDclassif)
data(wine)
wine <- wine[ wine$class == 1, ]
wine <- data.frame("malic_acid"=wine$V2, "proline"=wine$V13)

p4 <- ggplot(wine, aes(malic_acid, proline)) +
  geom_hotelling(type="data", level = .975, color = "red") +
  geom_hotelling(type="data", level = .975, robust = TRUE, color = "blue") +
  geom_point() +
  annotate("text", x=2.5, y = 1675, label = "MCD", color = "blue") +
  annotate("text", x=3.5, y = 1400, label = "Classical", color = "red") +
  ggtitle("Classical vs Robust Hotelling")

plot_grid(p1, p2, p3, p4, ncol=2)
```


# Features:

 * Classical Hotelling and data ellipses
 * Robust Hotelling ellipses using MCD estimator
 * Hotelling confidence ellipses for group means
 * Kernel density coverage contours with `geom_kde()`
 * Outlier detection and visualization with `stat_outliers()` 
 * Convex hulls with `geom_hull()`
 * Autoplot method for `prcomp` objects

See [the vignette](https://january3.github.io/gghotelling/) for more details.



## Installation

You can install the development version of gghotelling from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("january3/gghotelling")
```

## Minimal Example

The package defines a new geom, `geom_hotelling()`, which can be used to add Hotelling ellipses to ggplot2 scatter plots.

```{r example}
library(ggplot2)
library(gghotelling)

pca <- prcomp(iris[, 1:4], scale.=TRUE)
df <- cbind(iris, pca$x)

# minimum example
p1 <- ggplot(df, aes(PC1, PC2, color=Species)) +
  geom_hotelling() +
  geom_point()

# set custom CI/coverage level
p2 <- ggplot(df, aes(PC1, PC2, color=Species)) +
  geom_hotelling(alpha=0.1, aes(fill = Species), level=.99) +
  geom_point()

plot_grid(p1, p2, ncol=2)
```



